<div class="add-car-container">
  <h1>Добавить новый автомобиль</h1>

  <form [formGroup]="carForm" (ngSubmit)="onSubmit()" class="car-form">
    <div class="form-group">
      <label for="brand" class="required">Бренд</label>
      <input
        type="text"
        id="brand"
        formControlName="brand"
        placeholder="Toyota"
        [ngClass]="{ 'is-invalid': submitted && f['brand'].errors }"
      />
      <div *ngIf="submitted && f['brand'].errors" class="invalid-feedback">
        <div *ngIf="f['brand'].errors['required']">
          Поле обязательно для заполнения
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="model" class="required">Модель</label>
      <input
        type="text"
        id="model"
        formControlName="model"
        placeholder="Camry"
        [ngClass]="{ 'is-invalid': submitted && f['model'].errors }"
      />
      <div *ngIf="submitted && f['model'].errors" class="invalid-feedback">
        <div *ngIf="f['model'].errors['required']">
          Поле обязательно для заполнения
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="year" class="required">Год выпуска</label>
      <ng-select
        [items]="years"
        bindLabel="name"
        placeholder="Год выпуска"
        formControlName="year"
        [ngClass]="{ 'is-invalid': submitted && f['year'].errors }"
      >
      </ng-select>
      <div *ngIf="submitted && f['year'].errors" class="invalid-feedback">
        <div *ngIf="f['year'].errors['required']">
          Поле обязательно для заполнения
        </div>
        <div *ngIf="f['year'].errors['min'] || f['year'].errors['max']">
          Год должен быть между 1900 и {{ currentYear }}
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="engine" class="required">Двигатель</label>
      <ng-select
        [items]="engines"
        bindLabel="name"
        placeholder="Двигатель"
        formControlName="engine"
        [ngClass]="{ 'is-invalid': submitted && f['engine'].errors }"
      >
      </ng-select>
      <div *ngIf="submitted && f['engine'].errors" class="invalid-feedback">
        <div *ngIf="f['engine'].errors['required']">
          Поле обязательно для заполнения
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="transmission" class="required">Трансмиссия</label>
      <ng-select
        [items]="transmissionTypes"
        bindLabel="name"
        placeholder="Тип трансмиссии"
        formControlName="transmission"
        [ngClass]="{ 'is-invalid': submitted && f['transmission'].errors }"
      >
      </ng-select>
      <div
        *ngIf="submitted && f['transmission'].errors"
        class="invalid-feedback"
      >
        <div *ngIf="f['transmission'].errors['required']">
          Поле обязательно для заполнения
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="mileage" class="required">Пробег (км)</label>
      <input
        type="number"
        id="mileage"
        formControlName="mileage"
        placeholder="20000"
        min="0"
        [ngClass]="{ 'is-invalid': submitted && f['mileage'].errors }"
      />
      <div *ngIf="submitted && f['mileage'].errors" class="invalid-feedback">
        <div *ngIf="f['mileage'].errors['required']">
          Поле обязательно для заполнения
        </div>
        <div *ngIf="f['mileage'].errors['min']">
          Пробег не может быть отрицательным
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="fuelType" class="required">Тип топлива</label>
      <ng-select
        [items]="fuelTypes"
        bindLabel="name"
        placeholder="Тип топлива"
        formControlName="fuelType"
        [ngClass]="{ 'is-invalid': submitted && f['fuelType'].errors }"
      >
      </ng-select>
      <div *ngIf="submitted && f['fuelType'].errors" class="invalid-feedback">
        <div *ngIf="f['fuelType'].errors['required']">
          Поле обязательно для заполнения
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="horsepower">Мощность(В лошадиных силах)</label>
      <input
        type="number"
        id="horsepower"
        formControlName="horsepower"
        placeholder="100"
        [ngClass]="{ 'is-invalid': submitted && f['horsepower'].errors }"
      />
      <div
        *ngIf="submitted && f['horsepower'].errors"
        class="invalid-feedback"
      ></div>
    </div>

    <div class="form-group">
      <label for="country">Страна производитель</label>
      <ng-select
        [items]="countries"
        bindLabel="name"
        placeholder="Страна-производитель"
        formControlName="country"
        [ngClass]="{ 'is-invalid': submitted && f['country'].errors }"
      >
      </ng-select>
      <div
        *ngIf="submitted && f['country'].errors"
        class="invalid-feedback"
      ></div>
    </div>

    <div class="form-group">
      <label for="driveType">Привод</label>
      <ng-select
        [items]="driveTypes"
        bindLabel="name"
        placeholder="Тип привода"
        formControlName="driveType"
        [ngClass]="{ 'is-invalid': submitted && f['driveType'].errors }"
      >
      </ng-select>
      <div
        *ngIf="submitted && f['driveType'].errors"
        class="invalid-feedback"
      ></div>
    </div>

    <div class="form-group">
      <label for="bodyType">Тип кузова</label>
      <ng-select
        [items]="bodyTypes"
        bindLabel="name"
        placeholder="Тип кузова"
        formControlName="bodyType"
        [ngClass]="{ 'is-invalid': submitted && f['bodyType'].errors }"
      >
      </ng-select>
      <div
        *ngIf="submitted && f['bodyType'].errors"
        class="invalid-feedback"
      ></div>
    </div>

    <div class="form-group">
      <label for="color" class="required">Цвет</label>
      <ng-select
        [items]="colors"
        bindLabel="name"
        placeholder="Цвет"
        formControlName="color"
        [ngClass]="{ 'is-invalid': submitted && f['color'].errors }"
      >
      </ng-select>
      <div *ngIf="submitted && f['color'].errors" class="invalid-feedback">
        <div *ngIf="f['color'].errors['required']">
          Поле обязательно для заполнения
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="price" class="required">Цена (₽)</label>
      <input
        type="number"
        id="price"
        formControlName="price"
        placeholder="1000000"
        min="0"
        [ngClass]="{ 'is-invalid': submitted && f['price'].errors }"
      />
      <div *ngIf="submitted && f['price'].errors" class="invalid-feedback">
        <div *ngIf="f['price'].errors['required']">
          Поле обязательно для заполнения
        </div>
        <div *ngIf="f['price'].errors['min']">
          Цена не может быть отрицательной
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="images" class="required">Изображения</label>
      <input
        type="file"
        id="images"
        (change)="onFileChange($event)"
        multiple
        accept="image/jpeg, image/jpg, image/png"
        [ngClass]="{ 'is-invalid': submitted && f['images'].errors }"
      />
      <div *ngIf="submitted && f['images'].errors" class="invalid-feedback">
        <div *ngIf="f['images'].errors['required']">
          Необходимо загрузить хотя бы одно изображение
        </div>
        <div *ngIf="f['images'].errors['maxImageCount']">
          Максимальное количество изображений: {{ MAX_IMAGE_COUNT }}
        </div>
        <div *ngIf="f['images'].errors['maxImageSize']">
          Максимальный размер изображения: 3MB
        </div>
      </div>

      <div class="upload-hints">
        <small
          >Максимум {{ MAX_IMAGE_COUNT }} изображений, каждое не более
          3MB</small
        >
      </div>

      <div class="image-preview-container" *ngIf="previewUrls.length > 0">
        <h3>
          Предпросмотр изображений ({{ previewUrls.length }}/{{
            MAX_IMAGE_COUNT
          }}):
        </h3>
        <div class="image-preview-grid">
          <div
            class="image-preview"
            *ngFor="let url of previewUrls; let i = index"
          >
            <img [src]="url" alt="Превью изображения" />
            <button
              type="button"
              class="remove-image-btn"
              (click)="removeImage(i)"
            >
              ×
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="submit-btn">Добавить автомобиль</button>
      <button type="button" class="reset-btn" (click)="onReset()">
        Очистить форму
      </button>
    </div>
  </form>
</div>
